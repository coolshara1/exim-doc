
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Маршрутизатор redirect &mdash; Specification of the Exim Mail Transfer Agent 4.70 documentation</title>
    
    <link rel="stylesheet" href="static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '4.70',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="static/translations.js"></script>
    <link rel="top" title="Specification of the Exim Mail Transfer Agent 4.70 documentation" href="index.html" />
    <link rel="next" title="Среда для работы локальных транспортов" href="ch23.html" />
    <link rel="prev" title="Маршрутизатор queryprogram" href="ch21.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="static/small_flask.css" type= "text/css" rel="stylesheet" />

  </head>
  <body>
    <div class="related">
      <h3>Просмотр</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Словарь-указатель"
             accesskey="I">словарь</a></li>
        <li class="right" >
          <a href="ch23.html" title="Среда для работы локальных транспортов"
             accesskey="N">следующий</a> |</li>
        <li class="right" >
          <a href="ch21.html" title="Маршрутизатор queryprogram"
             accesskey="P">предыдущий</a> |</li>
        <li><a href="index.html">Specification of the Exim Mail Transfer Agent 4.70 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="redirect">
<span id="ch22-00"></span><h1>Маршрутизатор <strong>redirect</strong><a class="headerlink" href="#redirect" title="Ссылка на этот заголовок">¶</a></h1>
<p>Маршрутизатор <strong>redirect</strong> обрабатывает несколько видов переназначения адресов. Его самое частое использование - для разрешения локальной части адреса по центральному файлу синонимов (обычно это <em>/etc/aliases</em>), и для обработки пользовательского файла <em>.forward</em>, но также есть много других потенциальных возможностей использования. Входящий адрес может быть переадресован несколькими различными способами:
* Он может быть заменён одним, или более, новым адресом, которые будут маршрутизируется самостоятельно.
* Он может быть маршрутизирован для доставки в файл или директорию.
* Он может быть доставлен в специфическую трубу (pipe).
* Можно сделать автоматический ответ.
* Он может принудительно стать неудачным (fail), с необязательным сообщением об ошибке.
* Он может быть временно задержан, с необязательным сообщением.
* Он может быть отброшен.</p>
<p>Общий параметр <strong>transport</strong> не должен быть установлен для маршрутизатора <strong>redirect</strong>. Однако, есть некоторые частные параметры с заданным транспортом, для доставки в файлы и трубы, и для создания авто-ответов. Смотрите описания <strong>file_transport</strong>, <strong>pipe_transport</strong> и <strong>reply_transport</strong> ниже.</p>
<div class="section" id="ch22-01">
<span id="id1"></span><h2>Данные для перенаправления<a class="headerlink" href="#ch22-01" title="Ссылка на этот заголовок">¶</a></h2>
<p>Маршрутизатор функционирует путем интерпретации текстовой строки, которая получается либо в результате преобразования содержимого параметра <strong>data</strong>, либо в результате чтения содержимого файла, чье имя определено параметром <strong>file</strong>. Эти два параметра являются взаимоисключающими. Первый из них часто используется для обработки системных псевдонимов, в конфигурации наподобие данной:</p>
<div class="highlight-python"><pre>system_aliases:
  driver = redirect
  data = ${lookup{$local_part}lsearch{/etc/aliases}}</pre>
</div>
<p>Если поиск завершился неудачно, то раскрываемая строка в этом примере - пустая. В случае неудачного раскрытия параметра <strong>data</strong> - маршрутизатор пропускается. Принудительное завершение преобразования также ведет к пропуску маршрутизатора; другие ошибки раскрытия приводят к тому, что доставка временно откладывается.</p>
<p>Конфигурация с параметром <strong>file</strong> часто используется для обработки пользовательских файлов <em>.forward</em>, например таким образом:</p>
<div class="highlight-python"><pre>userforward:
  driver = redirect
  check_local_user
  file = $home/.forward
  no_verify</pre>
</div>
<p>Если файл не существует или не содержит никаких инструкций по выполнению (например, файл пуст или содержит только комментарии), то маршрутизатор пропускается. Внимание: это не тот случай, когда файл содержит синтаксически допустимые элементы, которые могут иногда выдавать пустые адреса, например элементы, содержащие только адресные комментарии в соответствии с <span class="target" id="index-0"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc2822.html"><strong>RFC 2822</strong></a>.</p>
</div>
<div class="section" id="forward-files">
<span id="ch22-02"></span><h2>Файлы пересылки (forward files) и проверка адреса<a class="headerlink" href="#forward-files" title="Ссылка на этот заголовок">¶</a></h2>
<p>Обычной практикой является установка параметра <strong>no_verify</strong> на маршрутизатор <strong>redirect</strong>, обрабатывающих пользовательские файлы <em>.forward</em>, как в вышеописанном примере. Для этого существуют 2 причины:
* Когда Exim принимает входящее SMTP-сообщение от удаленного узла, то он запускается от имени пользователя Exim (Exim uid), а не от имени суперпользователя (root). Exim не может изменить uid для чтения файла, чтобы прочитать его как владелец, а также возможно файл не будет доступен для чтения пользователю Exim. Таким образом, на практике маршрутизатор может не функционировать.
* Однако, даже когда маршрутизатор может работать, существование файла <em>.forward</em> неважно в то время когда адрес проверяется. Должно быть проверено только является ли локальная часть адреса допустимым именем пользователя или нет. Если убрать обработку перенаправления в данном случае, то это сохранит некоторые ресурсы.</p>
</div>
<div class="section" id="ch22-03">
<span id="id2"></span><h2>Обработка данных перенаправления<a class="headerlink" href="#ch22-03" title="Ссылка на этот заголовок">¶</a></h2>
<p>Содержимое строки данных, полученное либо через <strong>data</strong>, либо через <strong>file</strong>, может быть интерпретировано двумя разными способами:</p>
<ul class="simple">
<li>Если параметр <strong>allow_filter</strong> установлена в истинное значение и данные начинаются со строки “#Exim filter” или “#Sieve filter”, то содержимое интерпретируется как список “фильтрующих” инструкций в форме фильтров Exim или Sieve соответственно. Подробности синтаксиса и семантики файлов фильтров описаны в отдельном документе “Интерфейсы Exim для фильтрации почты”; предназначенном конечным пользователям.</li>
<li>В противном случае, данные должны представлять собой список элементов перенаправления (redirection items), разделенных “,”, как описано в следующей секции.
Когда сообщение перенаправляется в файл (“почтовая папка”), имя файла, описанного в списке перенаправления, не являющимся фильтром, должно быть абсолютным (т.е. до него указан полный путь). Фильтр может создавать относительный путь - то, как это обрабатывается зависит от конфигурации транспорта. См. раздел <a class="reference internal" href="ch26.html#ch26-01"><em>26.1</em></a> для описания этой темы, для транспорта <strong>appendfile</strong>.</li>
</ul>
</div>
<div class="section" id="ch22-04">
<span id="id3"></span><h2>Элементы не фильтрующего списка перенаправления<a class="headerlink" href="#ch22-04" title="Ссылка на этот заголовок">¶</a></h2>
<p>Если данные перенаправления не являются фильтрами Exim и Sieve, например, если они были получены из файла псевдонимов или файла <em>.forward</em>, то они содержат список адресов, имен файлов, конвейерных команд или специальных элементов (см. раздел <a class="reference internal" href="ch26.html#ch26-06"><em>22.6</em></a> ниже). Эти специальные элементы могут быть индивидуально включены или отключены посредством параметров, начинающихся с <strong>allow_</strong> или <strong>forbid_</strong>, в зависимости от значений по умолчанию. Элементы в списке разделены “,” или новыми строками. Если в элементе требуется символ “,”, то весь элемент должен быть заключен в двойные кавычки.</p>
<p>Строки, начинающиеся с символа “#” являются комментариями и игнорируются, также может встретиться символ “#” с последующей “,”, в этом случае все, что находится между “#” и следующим символом новой строки, игнорируется.</p>
<p>Если элемент целиком заключен в двойные кавычки, то они опускаются. В противном случае, они остаются потому как некоторые формы почтовых адресов требуют их использования (но никогда в кавычки не берется адрес целиком). В следующем описании под “элементом” понимается то, что остается после опускания кавычек.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p>Если вы используете преобразование Exim для построения адреса перенаправления, и преобразование содержит ссылку на $local_part, то вы должны использовать оператор раскрытия <strong>quote_local_part</strong>, на случай если локальная часть почтового адреса содержит спецсимволы. Например, чтобы перенаправить всю почту для домена “obsolete.example”, оставив неизменным существующую локальную часть адреса, то вы можете использовать такую конструкцию:</p>
<div class="last highlight-python"><pre>data = ${quote:$local_part}@newdomain.example</pre>
</div>
</div>
</div>
<div class="section" id="ch22-05">
<span id="id4"></span><h2>Перенаправление в локальный почтовый ящик<a class="headerlink" href="#ch22-05" title="Ссылка на этот заголовок">¶</a></h2>
<p>Элемент в списке перенаправления может быть в точности самим адресом. Это не вызовет зацикливания маршрутизации, потому что маршрутизатор автоматически пропускается, если родительский адрес обрабатываемого адреса совпадает с ним и обрабатывался он текущим маршрутизатором. Далее адрес передается следующим маршуртизатором, таким образом он обрабатывается как будто бы не было никакого перенаправления. В процессе проверки зацикливания используется полная локальная часть почтового адреса, включая префиксы и суффиксы.</p>
<p>Указание той же локальной части почтового адреса без указания домена в персональных файлах фильтров является обычной практикой в том случае, если пользователь хочет, чтобы сообщения доставлялись в локальный почтовый ящик а также перенаправлялись еще куда-нибудь. Например, пользователь с учетной записью “cleo” может иметь файл <em>.forward</em>, содержащий такую запись:</p>
<div class="highlight-python"><pre>cleo, cleopatra@egypt.example</pre>
</div>
<p>Для совместимости с другими MTA, такие локальные части могут быть предварены символом “\”, но это не является требованием для предотвращения зацикливания. Однако, это дает разницу если таким образом обрабатывается более одного домена.</p>
<p>Если элемент начинается с символа “\” и остальная часть его является адресом, соответствующим <span class="target" id="index-1"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc2822.html"><strong>RFC 2822</strong></a>, не включающим в себя домен, то этот элемент дополняется доменом входящего адреса. В отсутствие предшествующего символа “\” неполные адреса дополняются используя значение параметра <strong>qualify_recipient</strong>, но вы можете принудительно изменить входящий домен, используя параметр <strong>qualify_preserve_domain</strong>.</p>
<p>Если существуют псевдонимы для локальных пользователей, то нужно быть осторожным. Рассмотрим MTA, обрабатывающий простой локальный домен, где системный файл псевдонимов содержит:</p>
<div class="highlight-python"><pre>Sam.Reman: spqr</pre>
</div>
<p>Теперь предположим, что Сэм (чей идентификатор - “spqr”) хочет сохранять копии сообщений в локальном почтовом ящике, а также перенаправлять копии куда-либо еще. Он создает такой файл перенаправления:</p>
<div class="highlight-python"><pre>Sam.Reman, spqr@reme.elsewhere.example</pre>
</div>
<p>С подобными настройками входящее сообщение для “Sam.Reman” отклоняется. Маршрутизатор <strong>redirect</strong> для системных псевдонимов не обрабатывает “Sam.Reman” второй раз, потому как он уже маршрутизировал его, и следующие маршрутизаторы по-видимому тоже не смогут обработать псевдоним. Файл перенаправления должен на самом деле содержать:</p>
<div class="highlight-python"><pre>spqr, spqr@reme.elsewhere.example</pre>
</div>
<p>но т.к. это распространенная ошибка, то существует параметр <strong>check_ancestor</strong> (см. ниже) для ее обхода. Обычно она определяется в маршрутизаторе, обрабатывающем пользовательские файлы <em>.forward</em>.</p>
</div>
<div class="section" id="ch22-06">
<span id="id5"></span><h2>Специальные конструкции в списках перенаправления<a class="headerlink" href="#ch22-06" title="Ссылка на этот заголовок">¶</a></h2>
<p>Вдобавок к адресам в списках перенаправления (не являющихся фильтрами) могут быть следующие типы конструкций:</p>
<ul>
<li><p class="first">Элемент рассматривается как команда перенаправления если он начинается с символа “|” и не распознается как адрес соответствующий <span class="target" id="index-2"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc2822.html"><strong>RFC 2822</strong></a>. Транспорт для запуска этой команды должен быть определен параметром <strong>pipe_transport</strong>. Обычно, пользователь и группа, от имени которых выполняется доставка, определяются маршрутизатором или транспортом. По умолчанию, используются пользователь и группа, отведенные для Exim.</p>
<p>Одинарные или двойные кавычки могут использоваться для заключения аргументов команды перенаправления, причем для одинарных кавычек интерполяция содержимого внутри не производится. Если команда содержит символ “,”, то ее необходимо поместить в двойные кавычки, например:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&quot;|/some/command ready,steady,go&quot;</span>
</pre></div>
</div>
<p>т.к. элементы в списках перенаправления оканчиваются “,”. Однако недопустимо помещать в кавычки только команду. Например,</p>
<div class="highlight-python"><pre>|"/some/command ready,steady,go"</pre>
</div>
<p>интерпретируется как перенаправление вывода с довольно странным именем команды без аргументов.</p>
</li>
<li><p class="first">Элемент интерпретируется как путь, если он начинается с “/” и не распознается как адрес соответствующий <span class="target" id="index-3"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc2822.html"><strong>RFC 2822</strong></a>. Например,</p>
<div class="highlight-python"><pre>/home/world/minbari</pre>
</div>
<p>трактуется как имя файла, но</p>
<div class="highlight-python"><pre>/s=molari/o=babylon/@x400gate.way</pre>
</div>
<p>распознается как адрес. Для файла должен быть определен транспорт при помощи параметра <strong>file_transport</strong>. Однако, если путь оканчивается символом “/” то он интерпретируется как имя директории, а не имя файла, и в этом случае используется параметр <strong>directory_transport</strong>.</p>
<p>Обычно, пользователь и группа, от имени которых выполняется доставка, определяются маршрутизатором или транспортом. По умолчанию, используется пользователь и группа, из под которых работает Exim. Однако, если перенаправление производится в <em>/dev/null</em>, то доставка в него передается на высокий уровень, и запись в логе выглядит как “<strong>bypassed</strong>” вместо имени транспорта. В этом случае, пользователь и группа не используются.</p>
</li>
<li><p class="first">Если элемент выглядит таким образом:</p>
<div class="highlight-python"><pre>:include:&lt;path name&gt;</pre>
</div>
<p>то он представляет собой список дальнейших элеменотв, которые берутся из файла, находящегося по данному пути.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p>этот файл не может быть файлом фильтров; он является просто добавлением к списку. Элементы во включаемом списке разделяются “,” или новыми строками. Если это первый элемент в списке псевдонимов в файле, то имя псевдонима должно отделяться “:”. Следующий пример неверен:</p>
<div class="highlight-python"><pre>list1    :include:/opt/lists/list1</pre>
</div>
<p>Должно быть так:</p>
<div class="last highlight-python"><pre>list1:   :include:/opt/lists/list1</pre>
</div>
</div>
</li>
<li><p class="first">Иногда вы хотите выбрасывать почту с определенной локальной частью почтового адреса. Способ преобразования парамтера <strong>data</strong> в пустую строку не работает, поскольку он вызывает заклинивание маршрутизатора. Вместо этого используется синоним <em>:blackhole:</em>. То, что он делает, видно из его названия. Не происходит никакой доставки, и не создаются сообщения об ошибке. Это приводит к такому же эффекту, что и указание <em>/dev/null</em>, однако это может быть избирательно выключено.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Если <em>:blackhole:</em> указано где-либо в списке перенаправления, то доставка для исходной локальной части почтового адреса не выполняется, даже если присутствуют другие элементы перенаправления. Если вы создаете многоэлементный список (например, путем чтения из базы данных) и вам нужна возможность обеспечить элемент такого, который не выполняет доставку, то вы должны использовать <em>/dev/null</em>.</p>
</div>
</li>
<li><p class="first">Попытка доставки почты для определенного адреса может быть отложена или принудительно завершена неудачно при помощи элементов:</p>
<div class="highlight-python"><pre>:defer:</pre>
</div>
<p>или</p>
<div class="highlight-python"><pre>:fail:</pre>
</div>
<p>соответственно. Если список перенаправления содержит такой элемент, то он применяется ко всему перенаправлению; другие элементы в списке игнорируются. Любой текст следующий за <em>:fail:</em> или <em>:defer:</em> помещается в сообщение об ошибке, ассоциированное с этой неудачной доставкой. Например, файл псевдонимов может содержать:</p>
<div class="highlight-python"><pre>X.Employee:  :fail: Gone away, no forwarding address</pre>
</div>
<p>В случае адреса, проверяемого из ACL или командой VRFY, текст включается в сообщение об SMTP-ошибке по умолчанию. Текст не включается в ответ на команду “EXPN”. В не-SMTP случаях текст включается в формируемое Exim&#8217;ом сообщение об ошибке.</p>
<p>По умолчанию, Exim посылает код SMTP 451 для <em>:defer:</em> и 550 для <em>:fail:</em>. Однако, если сообщение начинается с трёх цифр сопровождаемых пробелом, необязательно сопровождаемых расширенным кодом вида “n.n.n”, также сопровождаемым пробелом, и самая первая цифра такая же как код ошибки по умолчанию, используется код из сообщения. Если самая первая цифра некорректна, в лог записывается паника, и используется код по умолчанию. Вы можете убрать использование предоставленного кода в маршрутизаторе <strong>redirect</strong>, установкой параметра <strong>forbid_smtp_code</strong> в истину. В этом случае, любой SMTP код тихо игнорируется.</p>
<p>В ACL, явно заданное сообщение замещает значение по умолчанию, но, сообщение по умолчанию доступно в переменной $acl_verify_message и, поэтому, может быть включено в собственное сообщение о ошибке - если вы этого хотите.</p>
<p>Обычно текст сообщения об ошибке располагается в конце списка перенаправления - символ “,” не завершает его - но символ новой строки действует как завершение списка. Новые строки обычно не присутствуют в списках псевдонимов. В поисках типа <strong>lsearch</strong> они удаляются в процессе преобразования, но они могут существовать в других типах поиска и в файлах <em>:include:</em>.</p>
<p>Во время маршрутизации сообщения (в отличие от проверки) перенаправление, содержащее элемент <em>:fail:</em> вызывает немедленное отклонение входящего адреса в то время как <em>:defer:</em> указывает сообщению оставаться в очереди так, что последующая попытка доставки может произвестись позже. Если адрес откладывается слишком долго, он может в конечном счете отклониться полностью, так как срабатывают правила повтора.</p>
<p>Иногда полезно использовать одноключевой (single-key) тип поиска (см. главу <a class="reference internal" href="ch09.html#ch09-00"><em>9</em></a>) для поиска псевдонимов. Однако, может быть потребность для исключений их этого. Они могут быть обработаны путем псевдонимизации их к <em>:unknown:</em>. Отличие от <em>:fail:</em> состоит в том, что это заставляет маршрутизатор <strong>redirect</strong> отклонять сообщение, в то время как <em>:fail:</em> принудительно завершает маршрутизацию ошибкой. Поиск, результатом которого является пустой список перенаправления, имеет тот же эффект.</p>
</li>
</ul>
</div>
<div class="section" id="ch22-07">
<span id="id6"></span><h2>Дублирование адресов<a class="headerlink" href="#ch22-07" title="Ссылка на этот заголовок">¶</a></h2>
<p>Exim убирает дублированные адреса из списка адресов, к которым совершается доставка, так что для каждого адреса доставляется только одна копия. Это правило не применяется к доставкам, перенаправляемым в потоки (pipes) различными родительскими адресами, однако непрямая схема псевдонимизации:</p>
<div class="highlight-python"><pre>pipe:       |/some/command $local_part
localpart1: pipe
localpart2: pipe</pre>
</div>
<p>не работает с сообщением, адресуемым обеим локальным частям, потому как когда второй из них ссылается на <strong>pipe</strong>, он отбрасывается как уже обработанный. Однако, схема</p>
<div class="highlight-python"><pre>localpart1: |/some/command $local_part
localpart2: |/some/command $local_part</pre>
</div>
<p>выполнит доставку в различные потоки, т.к. родители потоков различны.</p>
</div>
<div class="section" id="ch22-08">
<span id="id7"></span><h2>Повторяющееся преобразование перенаправления<a class="headerlink" href="#ch22-08" title="Ссылка на этот заголовок">¶</a></h2>
<p>В случае если сообщение не может быть доставлено всем адресатам за несколько попыток, то преобразование перенаправления проводится каждый раз заново для адресов, к дочерним адресам которых доставка не произошла. Если перенаправление используется как список рассылки, то это может привести к тому что новые подписчики получат копии старых сообщений. Параметр <strong>one_time</strong> может помочь этого избежать.</p>
</div>
<div class="section" id="ch22-09">
<span id="id8"></span><h2>Ошибки в списках перенаправления<a class="headerlink" href="#ch22-09" title="Ссылка на этот заголовок">¶</a></h2>
<p>Если установлен парамтер <strong>skip_syntax_errors</strong>, то неправильно написанный адрес, вызывающий ошибку разбора строки, пропускается, и в в главный лог-файл делается соответствующая запись. Это может быть полезно для автоматических списков рассылки. В любом случае, если в процессе создания списка новых адресов обнаруживается ошибка, то родительский исходный адрес откладывается. См. также параметр <strong>syntax_errors_to</strong>.</p>
</div>
<div class="section" id="ch22-10">
<span id="id9"></span><h2>Частные параметры маршрутизатора <strong>redirect</strong><a class="headerlink" href="#ch22-10" title="Ссылка на этот заголовок">¶</a></h2>
<table border="1" class="docutils" id="index-4">
<colgroup>
<col width="27%" />
<col width="24%" />
<col width="24%" />
<col width="25%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>allow_defer</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Установка этого параметра позволяет использовать <em>:defer:</em> в данных перенаправления (не в фильтрах), либо команду <strong>defer</strong> в файле фильтров Exim.</p>
<table border="1" class="docutils" id="index-5">
<colgroup>
<col width="26%" />
<col width="24%" />
<col width="24%" />
<col width="26%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>allow_fail</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если данный парметр истинна, то элемент <em>:fail:</em> можно использовать в списке перенаправления, и команда <strong>fail</strong> может использоваться в файле фильтров.</p>
<table border="1" class="docutils" id="index-6">
<colgroup>
<col width="29%" />
<col width="23%" />
<col width="23%" />
<col width="25%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>allow_filter</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Установка этого параметра позволяет Exim интерпретировать данные перенаправления, начинающихся с “#Exim filter” или “#Sieve filter” как множество инструкций по фильтрации. Есть несколько свойств файлов фильтров Exim, которые некоторые администраторы могут захотеть запретить; см. параметры <strong>forbid_filter_xxx</strong> ниже. Также возможно запретить конкретный тип фильтров, разрешая остальные; см. параметры <strong>forbid_exim_filter</strong> и <strong>forbid_sieve_filter</strong> ниже.</p>
<p>Фильтр запускается от имени пользователя и группы, определенных общими параметрами <strong>user</strong> и <strong>group</strong>. Они берут свои умолчательные значения из файла паролей если установлен параметр <strong>check_local_user</strong>, так что в случае наличия пользовательских файлов фильтров фильтр запускается от имени соответствующего пользователя. Если параметр <strong>allow_filter</strong> истинна, то Exim требует чтобы была выставлена параметр <strong>check_local_user</strong> или <strong>user</strong>.</p>
<table border="1" class="docutils" id="index-7">
<colgroup>
<col width="29%" />
<col width="23%" />
<col width="23%" />
<col width="25%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>allow_freeze</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Установка этого параметра позволяет использовать команду <strong>freeze</strong> в фильтре Exim. Эта команда чаще встречается в системных фильтрах, и выключена по умолчанию для фильтров перенаправления т.к. это не то, что вы бы хотели позволить делать обычным пользователям.</p>
<table border="1" class="docutils" id="index-8">
<colgroup>
<col width="31%" />
<col width="22%" />
<col width="22%" />
<col width="24%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>check_ancestor</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Этот параметр связан с обработкой созданных адресов, которые могут совпадать с некоторыми родительскими адресами в списке перенаправления для текущего адреса. Хотя данный параметр по умолчанию выключен в исходном коде, она включается в файл конфигурации по умолчанию для обработки пользовательских файлов <em>.forward</em>. Данный параметр рекомендуется для подобного использования маршрутизатора <strong>redirect</strong>.</p>
<p>Если установлен параметр <strong>check_ancestor</strong>, и если созданный адрес (включая домен) такой же как и родительский адрес текущего адреса, то он заменяется копией текущего адреса. Это помогает в случае когда локальная часть почтового адреса А псевдонимизируется на B, и B имеет файл <em>.forward</em>, указывающий обратно на А. Например, внутри домена, локальная часть “Joe.Bloggs” псевдонимизируется на “jb” и  <em>~jb/.forward</em> содержит:</p>
<div class="highlight-python"><pre>\Joe.Bloggs, &lt;other item(s)&gt;</pre>
</div>
<p>Без установки параметра <strong>check_ancestor</strong> любая из локальных частей почтового адреса (“jb” или “Joe.Bloggs”) обрабатывается каждым маршрутизатором один раз. Если “jb” - имя реального почтового ящика, то почта для “jb” доставляется (перенаправленная на “Joe.Bloggs” в файле <em>.forward</em> и обратно на “jb” как псевдоним), но почта на “Joe.Bloggs” не проходит. Установка <strong>check_ancestor</strong> на маршрутизаторе <strong>redirect</strong>, который обрабатывает файл <em>.forward</em>, позволяет избежать переопределения “jb” обратно в “Joe.Bloggs”, если это был оригинальный адрес. См. ниже параметр <strong>repeat_use</strong>.</p>
<table border="1" class="docutils" id="index-9">
<colgroup>
<col width="25%" />
<col width="22%" />
<col width="22%" />
<col width="31%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>check_group</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: see below</td>
</tr>
</tbody>
</table>
<p>Если используется параметр <strong>file</strong>, то группа-владелец файла проверяется только если установлен этот параметр. Разрешенные группы - это те, которые перечислены в параметре <strong>owngroups</strong>, вместе с пользовательской группой по умолчанию в случае если установлен параметр <strong>check_local_user</strong>. Если файл принадлежит неверной группе, то маршрутизация откладывается. Значение по умолчанию для этого параметра - истина в случае если установлен параметр <strong>check_local_user</strong> и параметр <strong>modemask</strong> дает права на запись для группы, либо установлен параметр <strong>owngroups</strong>. В любом другом случае она ложна и никаких проверок группы не выполняется.</p>
<table border="1" class="docutils" id="index-10">
<colgroup>
<col width="25%" />
<col width="22%" />
<col width="22%" />
<col width="31%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>check_owner</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: see below</td>
</tr>
</tbody>
</table>
<p>Если используется параметр <strong>file</strong>, то владелец файла проверяется только если установлена этот параметр. Если установлена <strong>check_local_user</strong>, то локальный пользователь получает разрешение; в другом случае владелец должен быть одним из перечисленных в параметре <strong>owners</strong>. Значение по умолчанию для этого параметра - истина если установлены параметры <strong>check_local_user</strong> или <strong>owners</strong>. В противном случае значение по умолчанию - ложь, и никаких проверок владельца не производится.</p>
<table border="1" class="docutils" id="index-11">
<colgroup>
<col width="17%" />
<col width="27%" />
<col width="27%" />
<col width="29%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>data</strong></td>
<td>Use: redirect</td>
<td>Type: string†</td>
<td>Default: unset</td>
</tr>
</tbody>
</table>
<p>Этот параметр является взаимоисключающей с параметром <strong>file</strong>. Одна из них должна быть определена, но не обе одновременно. Содержимое параметра <strong>data</strong> может преобразовываться, и затем использоваться как список элементов перенаправления, или как множество инструкций фильтров. Если преобразование выполняется неудачно или результатом является пустая строка или строка без эффекта (состоящая из комментариев), то маршрутизатор отклоняется.</p>
<p>Если используются инструкции фильтров, то строка должна начинаться с “#Exim filter”, и все комментарии в строке, включая этот, должны оканчиваться символом новой строки. Например:</p>
<div class="highlight-python"><pre>data = #Exim filter\n\
  if $h_to: contains Exim then save $home/mail/exim endif</pre>
</div>
<p>Если вы читаете данные из базы, где символы новой строки не могут быть включены, то вы можете использовать элемент преобразования “${sg}” для преобразования шаблона строки последовательности в символ новой строки.</p>
<table border="1" class="docutils" id="index-12">
<colgroup>
<col width="37%" />
<col width="21%" />
<col width="21%" />
<col width="22%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>directory_transport</strong></td>
<td>Use: redirect</td>
<td>Type: string†</td>
<td>Default: unset</td>
</tr>
</tbody>
</table>
<p>Маршрутизатор <strong>redirect</strong> устанавливает прямую доставку в каталог если путь, оканчивающийся символом “/” определяется как новый “адрес”. Транспорт для доставки определяется этим параметром, который после преобразования должен быть именем сконфигурированного транспорта. Обычно им является транспорт <strong>appendfile</strong>.</p>
<table border="1" class="docutils" id="index-13">
<colgroup>
<col width="17%" />
<col width="27%" />
<col width="27%" />
<col width="29%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>file</strong></td>
<td>Use: redirect</td>
<td>Type: string†</td>
<td>Default: unset</td>
</tr>
</tbody>
</table>
<p>Данный параметр определяет имя файла, содержащего данные для перенаправления. Она является взаимоисключающей с параметром <strong>data</strong>. Строка перед использованием преобразуется; если преобразование завершается неудачно - маршрутизатор отклоняется. Другие ошибки преобразования ведут к откладыванию доставки. Результатом успешного преобразования должен быть абсолютный путь. Файл читается целиком и используется как данные для перенаправления. Если данные представляют собой пустую строку или строку, состоящую из комментариев, то маршрутизатор отклоняется.</p>
<p>Если попытка открыть файл завершается неудачно вследствие того, что файл не существует, Exim выполняет проверку содержимого каталога, если только парметр <strong>ignore_enotdir</strong> не установлен в истину (см. ниже). Если каталог не существует, то доставка откладывается. Это может произойти в случае если пользовательские файлы <em>.forward</em> монтируются по NFS, и если существует проблема монтирования. Если каталог существует а файл - нет, маршрутизатор отклоняется.</p>
<table border="1" class="docutils" id="index-14">
<colgroup>
<col width="31%" />
<col width="22%" />
<col width="22%" />
<col width="24%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>file_transport</strong></td>
<td>Use: redirect</td>
<td>Type: string†</td>
<td>Default: unset</td>
</tr>
</tbody>
</table>
<p>Маршрутизатор <strong>redirect</strong> устанавливает прямую доставку в файл, если имя пути не оканчивающееся “/” определено как новый “адрес”. Используемый транспорт в данном случае определяется этим параметром, которая после преобразования должна содержать имя сконфигурированного транспорта. Обычно таким транспортом является транспорт <strong>appendfile</strong>. В процессе его работы имя файла содержится в переменной $address_file.</p>
<table border="1" class="docutils" id="index-15">
<colgroup>
<col width="37%" />
<col width="21%" />
<col width="21%" />
<col width="21%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>filter_prepend_home</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: true</td>
</tr>
</tbody>
</table>
<p>Когда этот параметр истинна и команда “save” в фильтре Exim&#8217;a определяет относительный путь, и задано значение “$home”, она автоматически добавляется к относительному пути. Если этот параметр установлен в ложь, ничего не происходит. Относительный путь передаётся транспорту неизменным.</p>
<table border="1" class="docutils" id="index-16">
<colgroup>
<col width="33%" />
<col width="22%" />
<col width="22%" />
<col width="23%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>forbid_blackhole</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если данный параметр истинна, то элемент <em>:blackhole:</em> не может быть указан в списке перенаправления.</p>
<table border="1" class="docutils" id="index-17">
<colgroup>
<col width="35%" />
<col width="21%" />
<col width="21%" />
<col width="23%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>forbid_exim_filter</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если данный параметр истинна, то только фильтры Sieve разрешены, когда параметр <strong>allow_filter</strong> истинна.</p>
<table border="1" class="docutils" id="index-18">
<colgroup>
<col width="27%" />
<col width="24%" />
<col width="24%" />
<col width="25%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>forbid_file</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если данный параметр истинна, то маршрутизатор не может создавать новый адрес, осуществляющий доставку в локальный файл или каталог либо посредством фильтра, либо посредством шаблонного файла пересылки (forward). Этот параметр принудительно устанавливается в “истину” если установлен параметр <strong>one_time</strong>. Она применяется как к фильтрам Sieve так и к фильтрам Exim, но если она истинна, то она блокирует возможность “keep” Sieve.</p>
<table border="1" class="docutils" id="index-19">
<colgroup>
<col width="38%" />
<col width="20%" />
<col width="20%" />
<col width="22%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>forbid_filter_dlfunc</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если данный параметр истинна, раскрытию строки в фильре exim`a не позволяется использовать средство раскрытия <strong>dlfunc</strong> для выполнения динамически загружаемых функций.</p>
<table border="1" class="docutils" id="index-20">
<colgroup>
<col width="41%" />
<col width="19%" />
<col width="19%" />
<col width="21%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>forbid_filter_existstest</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если данный параметр истинна, то преобразования строк в фильтрах Exim не разрешаются для использования в условии <strong>exists</strong> или <strong>stat</strong> выражении.</p>
<table border="1" class="docutils" id="index-21">
<colgroup>
<col width="39%" />
<col width="20%" />
<col width="20%" />
<col width="21%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>forbid_filter_logwrite</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если данный параметр истинна, то использовать запись в лог в фильтрах Exim не разрешено. Запись в лог в любом случае доступно, если фильтр запускается от имени непривилегированного пользователя (что является нормальным для пользовательских файлов <em>.forward</em>).</p>
<table border="1" class="docutils" id="index-22">
<colgroup>
<col width="38%" />
<col width="20%" />
<col width="20%" />
<col width="22%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>forbid_filter_lookup</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если данный параметр истинна, то преобразования строк для использования элементов <strong>lookup</strong> в фильтрах Exim не разрешается.</p>
<table border="1" class="docutils" id="index-23">
<colgroup>
<col width="35%" />
<col width="21%" />
<col width="21%" />
<col width="23%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>forbid_filter_perl</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Этот параметр доступен только в случае если Exim скомпилирован с поддержкой встроенного Perl. Если это так, то преобразования строк для использования встроенного Perl не разрешены.</p>
<table border="1" class="docutils" id="index-24">
<colgroup>
<col width="39%" />
<col width="20%" />
<col width="20%" />
<col width="21%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>forbid_filter_readfile</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если этот параметр истинна, то преобразования строк в файлах фильтров Exim для использования элементов <strong>readfile</strong> не разрешены.</p>
<table border="1" class="docutils" id="index-25">
<colgroup>
<col width="41%" />
<col width="19%" />
<col width="19%" />
<col width="21%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>forbid_filter_readsocket</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если этот параметр истинна, то преобразования строк в файлах фильтров Exim для использования элементов <strong>readsocket</strong> не разрешены.</p>
<table border="1" class="docutils" id="index-26">
<colgroup>
<col width="37%" />
<col width="21%" />
<col width="21%" />
<col width="22%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>forbid_filter_reply</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если этот параметр истинна, то данный маршрутизатор не может создать автоматический ответ. Автоответы могут создаваться только из файлов фильтров Exim, но не из традиционных файлов перенаправления или фильтров Sieve. Данный параметр автоматически становится истинной если определен параметр <strong>one_time</strong>.</p>
<table border="1" class="docutils" id="index-27">
<colgroup>
<col width="34%" />
<col width="21%" />
<col width="21%" />
<col width="23%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>forbid_filter_run</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если этот параметр истинна, то преобразования строк в файлах фильтров Exim для использования элементов <strong>run</strong> не разрешены.</p>
<table border="1" class="docutils" id="index-28">
<colgroup>
<col width="31%" />
<col width="22%" />
<col width="22%" />
<col width="24%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>forbid_include</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если данный параметр истинна, то элементы вида:</p>
<div class="highlight-python"><pre>:include:&lt;path name&gt;</pre>
</div>
<p>запрещены в списках перенаправления, не являющихся фильтрами.</p>
<table border="1" class="docutils" id="index-29">
<colgroup>
<col width="27%" />
<col width="24%" />
<col width="24%" />
<col width="25%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>forbid_pipe</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если данный параметр истинна, то маршрутизатор не может создавать новый адрес, определяющий доставку в трубу (pipe), равно как из фильтра Exim, так и из обычного файла перенаправления. Если установлен параметр <strong>one_time</strong>, то данный параметр автоматически становится истинной.</p>
<table border="1" class="docutils" id="index-30">
<colgroup>
<col width="37%" />
<col width="21%" />
<col width="21%" />
<col width="22%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>forbid_sieve_filter</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если этот параметр установлена в истину, то когда истина <strong>allow_filter</strong> разрешены только фильтры Exim&#8217;a.</p>
<table border="1" class="docutils" id="index-31">
<colgroup>
<col width="33%" />
<col width="22%" />
<col width="22%" />
<col width="23%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>forbid_smtp_code</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если этот параметр установлен в истину, любой код ошибки SMTP предоставленный в начале сообщения определённого для <em>:defer:</em> или <em>:fail:</em> тихо игнорируется, и всегда используется код по умолчанию (451 и 550 соответственно).</p>
<table border="1" class="docutils" id="index-32">
<colgroup>
<col width="38%" />
<col width="20%" />
<col width="20%" />
<col width="22%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>hide_child_in_errmsg</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если данный параметр истинна, то она вынуждает Exim скрывать дочерний адрес в случае, если созданное сообщение об отказе в доставке или о задержке. Вместо этого подставляется адрес созданный &lt;родительский адрес&gt;. Конечно, это применимо только к созданным локально сообщениям об отказе в доставке. Если сообщение перенаправляется на другой хост, то сообщение об отказе может быть послано на создаваемый адрес.</p>
<table border="1" class="docutils" id="index-33">
<colgroup>
<col width="30%" />
<col width="23%" />
<col width="23%" />
<col width="25%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>ignore_eacces</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если этот параметр установлен и попытка открыть файл перенаправления вызывает ошибку EACCES (доступ запрещен), то маршрутизатор <strong>redirect</strong> ведет себя как будто файл не существует.</p>
<table border="1" class="docutils" id="index-34">
<colgroup>
<col width="31%" />
<col width="22%" />
<col width="22%" />
<col width="24%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>ignore_enotdir</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если данный параметр определена и попытка открыть файл перенаправления вызывает ошибку ENOTDIR (что-либо в пути не является директорией), то маршрутизатор ведет себя как будто файл не существует.</p>
<p>Установка <strong>ignore_enotdir</strong> имеет другой эффект: Когда маршрутизатор <strong>redirect</strong>, имеющий параметр <strong>file</strong>, обнаруживает что данный файл не существует (ошибка ENOENT), он пытается выполнить функцию <em>stat()</em> для родительской директории, например при проверке на отмонтированные NFS директории. Если функция возвращает ненулевое значение, то доставка откладывается. Однако, неверно выполнять такую проверку когда установлен параметр <strong>ignore_enotdir</strong>, потому что этот параметр заставляет Exim игнорировать в пути “то, что не является директорией” (ошибка ENOTDIR). Это вопрос неоднозначный, потому как некоторые операционные системы выдают ошибку ENOENT, а некоторые - ENOTDIR.</p>
<table border="1" class="docutils" id="index-35">
<colgroup>
<col width="34%" />
<col width="21%" />
<col width="21%" />
<col width="23%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>include_directory</strong></td>
<td>Use: redirect</td>
<td>Type: string</td>
<td>Default: unset</td>
</tr>
</tbody>
</table>
<p>Если установлена этот параметр, пути любых элементов <em>:include:</em> в списке перенаправления должны начинаться с этой директории.</p>
<table border="1" class="docutils" id="index-36">
<colgroup>
<col width="21%" />
<col width="23%" />
<col width="34%" />
<col width="21%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>modemask</strong></td>
<td>Use: redirect</td>
<td>Type: octal integer</td>
<td>Default: 022</td>
</tr>
</tbody>
</table>
<p>Параметр определяет биты режима, которые не должны быть установлены для файла, определенного параметром <strong>file</strong>. Если установлен любой из этих битов, то доставка откладывается.</p>
<table border="1" class="docutils" id="index-37">
<colgroup>
<col width="23%" />
<col width="25%" />
<col width="25%" />
<col width="27%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>one_time</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Иногда факт что Exim перечитывает файл псевдонимов и заново обрабатывает файлы перенаправления каждый раз когда он пытается доставить сообщение, вызывает проблему когда один или несколько созданных адресов не могут быть доставлены с первой попытки. Это не является проблемой повторной доставки - Exim способен это обработать - кроме ситуаций когда список перенаправления меняется во время, когда сообщение находится в очереди Exim&#8217;a. Это особенно справедливо в случае списков рассылки, когда новые подписчики могут получить копии сообщений в случае если они были посланы до того как они подписались на рассылку.</p>
<p>Если параметр <strong>one_time</strong> установлен и любые адреса созданные маршрутизатором не удается обработать с первой попытки, то эти адреса добавляются к сообщению как адреса “верхнего уровня” (top level) и родительский адрес, который их создал помечается как <strong>delivered</strong>. То есть перенаправление на следующей попытке доставки не происходит.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Это означает что любое добавление или удаление заголовков, определяемое маршрутизатором будет утеряно если доставка не будет произведена успешно с первой попытки. В этом случае когда установлен параметр <strong>one_time</strong> параметры <strong>headers_add</strong> и <strong>headers_remove</strong> не разрешены.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Для обеспечения того чтобы маршрутизатор создавал только адреса (в отличие от труб (pipes), доставок в файлы (file deliveries) или авто-ответов (auto-replies)), параметры <strong>forbid_file</strong>, <strong>forbid_pipe</strong> и <strong>forbid_filter_reply</strong> принудительно устанавливаются в значение “истина” когда установлен параметр <strong>one_time</strong>.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Общий маршрутизатор <strong>unseen</strong> не может быть задан с <strong>one_time</strong>.</p>
</div>
<p>Оригинальный адрес верхнего уровня запоминается с каждым из созданных адресов, и выводится в любых логах. Однако, промежуточные адреса на записываются. Это создаёт различие для логов только если селектор логов <strong>all_parents</strong> установлен. Ожидается, что обычно <strong>one_time</strong> будет использоваться для списка адресатов, где есть лишь один уровень раскрытия.</p>
<table border="1" class="docutils" id="index-38">
<colgroup>
<col width="19%" />
<col width="24%" />
<col width="31%" />
<col width="26%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>owners</strong></td>
<td>Use: redirect</td>
<td>Type: string list</td>
<td>Default: unset</td>
</tr>
</tbody>
</table>
<p>Это определяет список разрешённых владельцев для файла заданного как <strong>file</strong>. Этот список - дополнение к локальному пользователю, когда установлен параметр <strong>check_local_user</strong>. Смотрите <strong>check_owner</strong> ниже.</p>
<table border="1" class="docutils" id="index-39">
<colgroup>
<col width="23%" />
<col width="23%" />
<col width="30%" />
<col width="25%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>owngroups</strong></td>
<td>Use: redirect</td>
<td>Type: string list</td>
<td>Default: unset</td>
</tr>
</tbody>
</table>
<p>Это определяет список разрешённых групп для файла заданного как <strong>file</strong>. Этот список - дополнение к локальной группе, когда установлен параметр <strong>check_local_user</strong>. Смотрите параметр <strong>check_group</strong> выше.</p>
<table border="1" class="docutils" id="index-40">
<colgroup>
<col width="31%" />
<col width="22%" />
<col width="22%" />
<col width="24%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>pipe_transport</strong></td>
<td>Use: redirect</td>
<td>Type: string†</td>
<td>Default: unset</td>
</tr>
</tbody>
</table>
<p>Маршрутизатор <strong>redirect</strong> задаёт прямую доставку в трубу, когда строка начинающаяся с “|” задана как новый “адрес”. Используемый транспорт определён этим параметром, который, после раскрытия, должен быть назван именем настроенного транспорта. Когда транспорт запущен, команда pipe в $address_pipe.</p>
<table border="1" class="docutils" id="index-41">
<colgroup>
<col width="31%" />
<col width="22%" />
<col width="22%" />
<col width="24%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>qualify_domain</strong></td>
<td>Use: redirect</td>
<td>Type: string†</td>
<td>Default: unset</td>
</tr>
</tbody>
</table>
<p>Если этот параметр установлен, и создан неполный адрес (без домена), и в нормальных условиях этот адрес был бы квалифицирован (дополнен доменным именем) по глобальному параметру <strong>qualify_recipient</strong>, но вместо этого он квалифицируется доменом, содержащимся в этой строке, после раскрытия. Если раскрытие неудачно, маршрутизатор снижается(?). Если вы хотите вернуться к значению по умолчанию, то можно раскрыть $qualify_recipient.</p>
<p>Этот параметр применяется ко всем неполным адресам созданных фильтрами Exim`a, но для традиционных файлов <em>.forward</em> это применяется лишь для адресов не предварённых обратным слешем. Фильтры Sieve не могут создавать неполные адреса.</p>
<table border="1" class="docutils" id="index-42">
<colgroup>
<col width="40%" />
<col width="19%" />
<col width="19%" />
<col width="21%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>qualify_preserve_domain</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если установлен этот параметр, то локальный параметр <strong>qualify_domain</strong> не должен быть задан (будет ошибка конфигурации, если задать оба). Если создается неполный адрес (без домена), он дополняется доменом родительского адреса (предыдущий предок), вместо глобального домена из <strong>qualify_recipient</strong>. В случае традиционного файла <em>.forward</em> это применяется вне зависимости от того, был ли перед адресом обратный слэш.</p>
<table border="1" class="docutils" id="index-43">
<colgroup>
<col width="26%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>repeat_use</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: true</td>
</tr>
</tbody>
</table>
<p>Если этот параметр установлен в “false”, то маршрутизатор пропускается для дочерних адресов, предки которых были маршрутизированны этим маршрутизатором. Это проверяется до проверки других предварительных условий. Правила Exim`a по умолчанию против зацикливания пропускаются лишь в случае если предок с таким же адресом как и текущий. Смотрите также параметры <strong>check_ancestor</strong> и <strong>redirect_router</strong>.</p>
<table border="1" class="docutils" id="index-44">
<colgroup>
<col width="32%" />
<col width="22%" />
<col width="22%" />
<col width="24%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>reply_transport</strong></td>
<td>Use: redirect</td>
<td>Type: string†</td>
<td>Default: unset</td>
</tr>
</tbody>
</table>
<p>Маршрутизатор <strong>redirect</strong> устанавливает автоответ когда в фильтре используются команды <strong>mail</strong> или <strong>vacation</strong>. Используемый транспорт определяется этим параметром, который, после раскрытия, должен быть именем настроенного транспорта. Обычно это транспорт <strong>autoreply</strong>. Другие транспорты вряд ли смогут принести какую-то пользу.</p>
<table border="1" class="docutils" id="index-45">
<colgroup>
<col width="22%" />
<col width="26%" />
<col width="26%" />
<col width="26%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>rewrite</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: true</td>
</tr>
</tbody>
</table>
<p>Если этот параметр установлен в “false”, адреса созданные маршрутизатором не являются объектами для перезаписи адреса. Иначе, они будут обработаны как новые адреса и перезаписаны в соответствии с глобальными правилами перезаписи.</p>
<table border="1" class="docutils" id="index-46">
<colgroup>
<col width="33%" />
<col width="22%" />
<col width="22%" />
<col width="23%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>sieve_subaddress</strong></td>
<td>Use: redirect</td>
<td>Type: string†</td>
<td>Default: unset</td>
</tr>
</tbody>
</table>
<p>Значение этого параметра передаётся фильтру Sieve для задания части адреса <tt class="docutils literal"><span class="pre">:subaddress</span></tt>.</p>
<table border="1" class="docutils" id="index-47">
<colgroup>
<col width="34%" />
<col width="21%" />
<col width="21%" />
<col width="23%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>sieve_useraddress</strong></td>
<td>Use: redirect</td>
<td>Type: string†</td>
<td>Default: unset</td>
</tr>
</tbody>
</table>
<p>Значение этого параметра передаётся фильтру Sieve для задания части адреса <tt class="docutils literal"><span class="pre">:user</span></tt>. Если она не задана, для <tt class="docutils literal"><span class="pre">:user</span></tt> используется оригинальная локальная часть адреса (включая суффикс и префикс).</p>
<table border="1" class="docutils" id="index-48">
<colgroup>
<col width="41%" />
<col width="19%" />
<col width="19%" />
<col width="21%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>sieve_vacation_directory</strong></td>
<td>Use: redirect</td>
<td>Type: string†</td>
<td>Default: unset</td>
</tr>
</tbody>
</table>
<p>Для включения расширения <strong>vacation</strong> для фильтров Sieve, вы должны задать <strong>sieve_vacation_directory</strong> в каталог где находятся БД <strong>vacation</strong> (больше ничего не помещайте в эту директорию), и гарантировать, что параметр <strong>reply_transport</strong> относится к транспорту <strong>autoreply</strong>. Каждому пользователю необходим собственный каталог; Exim создаст их в случае необходимости.</p>
<table border="1" class="docutils" id="index-49">
<colgroup>
<col width="35%" />
<col width="21%" />
<col width="21%" />
<col width="23%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>skip_syntax_errors</strong></td>
<td>Use: redirect</td>
<td>Type: boolean</td>
<td>Default: false</td>
</tr>
</tbody>
</table>
<p>Если установлен параметр <strong>skip_syntax_errors</strong>, синтаксически неправильные адреса, в переназначении вне фильтра, пропускаются, и каждый неудачный адрес записывается в логи. Если установлен параметр <strong>syntax_errors_to</strong>, то сообщение посылается по заданному в ней адресу с подробностями о неудаче. Если установлен параметр <strong>syntax_errors_text</strong>, её содержимое раскрывается и помещается в начале сообщения об ошибке, созданного <strong>syntax_errors_to</strong>. Обычно, она принудительно устанавливает <strong>syntax_errors_to</strong> к тому же адресу, что и общий параметр <strong>errors_to</strong>. Параметр <strong>skip_syntax_errors</strong> часто используется для обработки лисов рассылки.</p>
<p>Если все адреса в списке редиректа пропущены из-за ошибок синтаксиса, маршрутизатор отказывается обрабатывать оригинальный адрес, и он передаётся последующим маршрутизаторам.</p>
<p>Если параметр <strong>skip_syntax_errors</strong> установлена при интерпретации фильтра Exim`a, любые синтаксические ошибки в фильтре вызывают пропуск без предпринятия какого-либо действия. Инцидент записывается, и маршрутизатор отказывается обрабатывать адрес, и адрес передаётся следующим маршрутизатором.</p>
<p>Любые синтаксические ошибки в фильтрах Sieve, повод для действия <strong>keep</strong>. Это действие определено <span class="target" id="index-50"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc3028.html"><strong>RFC 3028</strong></a>. Значения <strong>skip_syntax_errors</strong>, <strong>syntax_errors_to</strong>, и <strong>syntax_errors_text</strong> не используются.</p>
<p>Параметр <strong>skip_syntax_errors</strong> может использоваться для задания тех ошибок в пользовательских списках перенаправления или файлах фильтра, используемых с адресом который не переадресуется, могут быть использованы для уведомления пользователей об этих ошибках, с помощью такого маршрутизатора:</p>
<div class="highlight-python"><pre>userforward:
  driver = redirect
  allow_filter
  check_local_user
  file = $home/.forward
  file_transport = address_file
  pipe_transport = address_pipe
  reply_transport = address_reply
  no_verify
  skip_syntax_errors
  syntax_errors_to = real-$local_part@$domain
  syntax_errors_text = \
    This is an automatically generated message. An error has\n\
    been found in your .forward file. Details of the error are\n\
    reported below. While this error persists, you will receive\n\
    a copy of this message for every message that is addressed\n\
    to you. If your .forward file is a filter file, or if it is\n\
    a non-filter file containing no valid forwarding addresses,\n\
    a copy of each incoming message will be put in your normal\n\
    mailbox. If a non-filter file contains at least one valid\n\
    forwarding address, forwarding to the valid addresses will\n\
    happen, and those will be the only deliveries that occur. \n\
    \n\
    Честно говоря, ломает перводить чё тут написано, сами напишете \n\
    что захотите :))) Общий смысл - про ошибку в фильтре пользователя, \n\
    которому эта мессага и пошлётся.</pre>
</div>
<p>Также, вам необходим маршрутизатор, чтобы гарантировать, что локальные адреса у которых распознан преффикс <tt class="docutils literal"><span class="pre">real-</span></tt>, не форвардятся и не фильтруются. Для примера, его можно поместить сразу перед маршрутизатором <strong>userforward</strong>:</p>
<div class="highlight-python"><pre>real_localuser:
  driver = accept
  check_local_user
  local_part_prefix = real-
  transport = local_delivery</pre>
</div>
<p>В целях безопасности, было бы хорошей идеей ограничить использование этого маршрутизатора локально созданными сообщениями, используя условие типа такого:</p>
<div class="highlight-python"><pre>condition = ${if match {$sender_host_address}\
                       {\N^(|127\.0\.0\.1)$\N}}</pre>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="21%" />
<col width="21%" />
<col width="23%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>syntax_errors_text</strong></td>
<td>Use: redirect</td>
<td>Type: string†</td>
<td>Default: unset</td>
</tr>
</tbody>
</table>
<p>Смотрите выше, параметр <strong>skip_syntax_errors</strong>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="22%" />
<col width="20%" />
<col width="24%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>syntax_errors_to</strong></td>
<td>Use: redirect</td>
<td>Type: string</td>
<td>Default: unset</td>
</tr>
</tbody>
</table>
<p>Смотрите выше, параметр <strong>skip_syntax_errors</strong>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Содержание</a></h3>
  <ul>
<li><a class="reference internal" href="#">Маршрутизатор <strong>redirect</strong></a><ul>
<li><a class="reference internal" href="#ch22-01">Данные для перенаправления</a></li>
<li><a class="reference internal" href="#forward-files">Файлы пересылки (forward files) и проверка адреса</a></li>
<li><a class="reference internal" href="#ch22-03">Обработка данных перенаправления</a></li>
<li><a class="reference internal" href="#ch22-04">Элементы не фильтрующего списка перенаправления</a></li>
<li><a class="reference internal" href="#ch22-05">Перенаправление в локальный почтовый ящик</a></li>
<li><a class="reference internal" href="#ch22-06">Специальные конструкции в списках перенаправления</a></li>
<li><a class="reference internal" href="#ch22-07">Дублирование адресов</a></li>
<li><a class="reference internal" href="#ch22-08">Повторяющееся преобразование перенаправления</a></li>
<li><a class="reference internal" href="#ch22-09">Ошибки в списках перенаправления</a></li>
<li><a class="reference internal" href="#ch22-10">Частные параметры маршрутизатора <strong>redirect</strong></a></li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="ch21.html" title="предыдущая глава">Маршрутизатор <strong>queryprogram</strong></a></li>
      <li>Next: <a href="ch23.html" title="следующая глава">Среда для работы локальных транспортов</a></li>
  </ul></li>
</ul>
  <h3>На этой странице</h3>
  <ul class="this-page-menu">
    <li><a href="sources/ch22.txt"
           rel="nofollow">Показать исходный текст</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Быстрый поиск</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Искать" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Введите слова для поиска или имя модуля, класса или функции.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy; Copyright 2011, Exim Maintainers.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
    </div>
  </body>
</html>