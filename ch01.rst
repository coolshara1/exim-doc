Введение
========

Exim - агент передачи почты (MTA) для UNIX или UNIX-подобных операционных систем. Он был спроектирован с расчётом, что будет выполняться на хостах, постоянно соединённых с Интернетом, однако он может использоваться и в системах, не имеющих постоянного подключения к Интернету, после соответствующего изменения настроек.

В настоящее время конфигурационные файлы существуют для следующих операционных систем: AIX, BSD/OS (иначе - BSDI), Darwin (Mac OS X), DGUX, Dragonfly, FreeBSD, GNU/Hurd, GNU/Linux, HI-OSF (Hitachi), HI-UX, HP-UX, IRIX, MIPS RISCOS, NetBSD, OpenBSD, OpenUNIX, QNX, SCO, SCO SVR4.2 (иначе - UNIX-SV), Solaris (aka SunOS5), SunOS4, Tru64-Unix (formerly Digital UNIX, formerly DEC-OSF1), Ultrix, и Unixware. Некоторые из этих операционных систем более не используются и работоспособность конфигурационных файлов для них не может быть легко проверена. Поэтому имейте в виду, что они, возможно, нерабочие.

Также есть конфигурационные файлы для сборки exim в среде Cygwin, установленной на системах под управлением ОС Windows. Однако этот документ не содержит какой бы то ни было информации о работе exim в среде Cygwin.

Условия и ограничения на использование и распространение exim содержатся в файле “NOTICE”. Exim распространяется в соответствии с GNU General Public Licence, копия которой может быть найдена в файле “LICENCE”.

Использование, поставка, или реклама exim для массовой рассылки нежелательной электронной почты несовместимы с основными целями программы, которые сосредоточены вокруг бесплатных сервисов, увеличивающих качество персональной связи. Автор exim расценивает массовую беспорядочную рассылку электронной почты как антиобщественное, безответственное злоупотребление Интернетом.

Exim многим обязан Smail 3 и его автору, Рону Карру (Ron Karr). Без опыта запуска и работы с кодом Smail 3, я, возможно, никогда бы и не собрался писать новый MTA. Многие из идей и пользовательских интерфейсов были первоначально взяты из Smail 3, хотя актуальный код exim является полностью новым и развился далеко за пределы начальной концепции.

Много людей и в Кембридже, и во всём мире внесли свой вклад в разработку и тестирование exim, а также в портирование его на различные операционные системы. Я благодарен им всем. Дистрибутив теперь содержит файл с именем “ACKNOWLEDGMENTS”, в котором я начал запись имён всех, кто помог.

Документация exim
-----------------

Эта редакция спецификации exim применима к версии 4.70. Различия с версией 4.69 отмечены в некоторых вариантах документа; этот параграф отмечен таким же образом в тех местах, где есть отличия.

Этот документ - справочное руководство; это не обучающий документ. Предполагается, что читатель уже имеет некоторое представление о почтовом протоколе SMTP и общем администрировании UNIX-систем. Информация по большей части организована для облегчения поиска, а не в естественном порядке для последовательного чтения, хотя в некоторых местах есть обсуждения и примеры. Кроме того, это руководство стремится подробно охватить каждый аспект exim, включая множество редко используемых особенностей специального назначения, которые вряд ли будут представлять широкий интерес.

Более “простое” обсуждение Exim, с более многосторонними пояснениями и вводными материалами может быть найдено в книге “The Exim SMTP Mail Server” (вторая редакция, 2007 год), изданной в Кембридже (http://www.uit.co.uk/exim-book/).

Также эта книга содержит главу, дающую общее введение в SMTP и интернет-почту. Неизбежно, что книга вряд ли будет полностью совместима с последним выпуском exim. (Отметьте, что более ранняя книга об exim, изданная O’Reilly, посвящена exim 3 и за прошедшее с тех пор время в exim4 появилось много особенностей.)

Если Вы используете сборку exim для дистрибутива debian, Вы можете найти информацию об особенностях использования exim с этим дистрибутивом в файле */usr/share/doc/exim4-base/README.Debian*. Команда **man update-exim.conf** - ещё один источник специфической для debian информации.

Поскольку программа развивается, в новых версиях могут быть особенности, которые ещё не внесены в этот документ, обновляемый при изменении версии exim'a. Спецификации новых возможностей, не включённые в этот документ, помещены в файл *doc/NewStuff* дистрибутива exim.

Некоторые возможности классифицируются как “экспериментальные”. В ходе разработки они могут несовместимо измениться, или вообще быть убраны. Поэтому они не описаны в этом руководстве. Информацию об экспериментальных возможностях можно найти в файле *doc/experimental.txt*.

Все изменения в программе (новые возможности, исправления ошибок, и т.п.) кратко описаны в файле *doc/ChangeLog*.

Эта спецификация доступна в качестве ASCII файла *doc/spec.txt*, таким образом его просмотр легко осуществим любым текстовым редактором. Другие файлы в директории doc:

=================  ========
\                  \ 
=================  ========
OptionLists.txt    список всех опций в алфавитном порядке
dbm.discuss.txt    обсуждение библиотек DBM
exim.8             man-страница опций командной строки exim
experimental.txt   документация экспериментальных возможностей
filter.txt         спецификация языка фильтра
Exim3.upgrade      примечания обновления с релиза 2 до релиза 3
Exim4.upgrade      примечания обновления с релиза 3 до релиза 4
=================  ========

Главная спецификация и спецификация языка фильтрации также доступны в других форматах (HTML, PostScript, PDF, и Texinfo). Раздел 1.6 ниже описывает как получить их.

FTP и WEB сайты
---------------

В настоящее время главным сайтом по распространению исходных кодов exim является FTP-сайт университета Кембриджа, содержание которого описано ниже, “Где найти дистрибутив exim”. Кроме того, есть веб- и ftp-сайт exim.org, он хостится на площадке университета Кембриджа. Раньше сайт exim.org хостился много лет на Energis Squared, ранее Planet Online Ltd, технической поддержке которых я благодарен.

Кроме файлов tar, дистрибутива exim, веб-сайт exim`a содержит множество различно отформатированных версий документации. Недавнее дополнение к онлайн-документации exim - wiki (http://wiki.exim.org/), которая содержит различные FAQ, а также разнообразные примеры, подсказки, how-to....

Bugzilla exim'a находиться по адресу: http://bugs.exim.org. Вы можете использовать её для сообщений об ошибках, а также для ваших пожеланий. Только сначала воспользуйтесь поиском, пожалуйста, чтобы убедиться, что вы не создаёте дубликата проблемы.

Листы рассылки
--------------

Существуют следущие списки рассылки exim'a:

======================  ========
\                       \                        
======================  ========
exim-users@exim.org     обсуждение общих вопросов
exim-dev@exim.org       обсуждение ошибок, расширений и т.п.
exim-announce@exim.org  модерируемый, небольшой по объёму список анонсов
exim-future@exim.org    дискуссии о долгосрочной разработке
======================  ========

Вы можете подписаться на эти списки, изменить ваши существующие подписки, а также просматривать или искать в архивах списков рассылок на домашней странице exim. Если вы используете сборку exim'a для дистрибутива Debian, вы можете подписаться на рассылку этой сборки “pkg-exim4-users@lists.alioth.debian.org”, используя эту страницу: http://lists.alioth.debian.org/mailman/listinfo/pkg-exim4-users

Пожалуйста, задавайте специфические для Debian вопросы в данной рассылке, а на в общем списке рассылок exim.

Курсы exim
----------

До ухода в отставку автора exim'a в университете Кембриджа (Англии) проводились тренировочные курсы. На момент написания, не существовало планов на проведение курсов по exim в Кембридже. Однако, в случае изменений, релевантная информация может быть найдена на этой странице: http://www-tus.csx.cam.ac.uk/courses/exim/.

Сообщения об ошибках
--------------------

Сообщения об очевидных ошибках могут быть отправлены по электронной почте на адрес bugs@exim.org, или созданы в Bugzilla. Однако, если вы не уверены, что это поведение является ошибкой, лучше всего будет отправить сообщение на лист рассылки “exim-dev” и обсудить его.

Где найти дистрибутив exim
--------------------------

Главный ftp-сайт дистрибутива exim это:: 

  ftp://ftp.csx.cam.ac.uk/pub/software/email/exim

Это его зеркало::

  ftp://ftp.exim.org/pub/exim

Ссылки на файлы даны относительно директории “exim” на этом сайте. Также есть много независимых зеркал по всему миру. Те, которые я знаю, перечислены в файле “Mirrors”.

Внутри каталога “exim” есть подкаталоги с именами “exim3” (для предыдущего дистрибутива exim3), “exim4” (для последнего дистрибутива exim4) и “Testing” - для тестовых версий. в подкаталоге “exim4”, всегда может быть найден текущий релиз в файлах с именами::

  exim-n.nn.tar.gz
  exim-n.nn.tar.bz2
         
где “n.nn” - самый большой номер версии в директории. Два файла содержат идентичные данные; различие лишь в типе компрессии. Файл “.bz2” обычно намного меньше чем “.gz”.

В настоящее время дистрибутивы подписываются GPG ключом Nigel Metheringham'a. Соответствующий открытый ключ доступен на множестве ключевых серверов, и также скопирован в файл “nigel-pubkey.asc”. Подписи для tar находятся в::

  exim-n.nn.tar.gz.asc
  exim-n.nn.tar.bz2.asc

Для каждой выпущенной версии лог изменений доступен отдельно в директории “ChangeLogs”, таким образом об изменениях можно узнать без необходимости загружать весь дистрибутив.

Главный дистрибутив содержит ASCII версию этой спецификации и другую документацию; другие форматы документации доступны на FTP-сайте, внутри директории “exim4”, в отдельных файлах::

  exim-html-n.nn.tar.gz
  exim-pdf-n.nn.tar.gz
  exim-postscript-n.nn.tar.gz
  exim-texinfo-n.nn.tar.gz

Эти tar-файлы содержат только директорию *doc*, а не полный дистрибутив, и также доступны в форматах *.bz2* и *.gz*.

Ограничения
-----------

* Exim спроектирован как MTA для использования в Интернете, и поэтому обрабатывает адреса только в формате доменов по :rfc:`2822`. Он не может обрабатывать адреса UUCP с восклицательными знаками, хотя простые двухкомпонентные адреса с восклицательными знаками могут быть конвертированы конфигурацией перезаписи адресов. Это ограничение не препятствует привязке exim`a через интерфейс к UUCP как транспортного механизма при условии, что используются адреса доменов.
* Exim настаивает на прикреплении к каждому обрабатываемому адресу домена. Для входящих локальных сообщений адреса без домена автоматически дополняются доменом, указанным в конфигурации. В конфигурации также определяются удалённые системы, от которых допускается приём писем с неквалифицированными адресами. Тогда они квалифицируются по прибытии.
* Единственные внешние транспортные механизмы, реализованные на данный момент, это SMTP и LMTP по сети TCP/IP (включая поддержку IPv6). Однако доступен транспорт pipe и есть средства для записи сообщений в файлы и трубы (pipe), опционально в пакетном SMTP-формате; эти средства могут использоваться для отсылки сообщений другим транспортным механизмам, типа UUCP, если они могут обработать адреса в доменном стиле. Также обслуживается пакетный SMTP-ввод.
* Exim не спроектирован для хранения почты для хостов, соединяющихся по модему. При большом объёме тако почты лучше доставлять сообщения в файлы (т.е. убирать из очереди exim`a) и впоследствии передавать её дозванивающимся хостам другими средствами.
* Хотя exim имеет базовые возможности для сканирования входящих сообщений, они не являются достаточными для полной проверки на вирусы и спам. Такие операции лучше осуществлять, используя программные пакеты сторонних производителей. Если вы скомпилируете exim с контентным сканированием, то будет поддерживаться множество сканеров прямо на интерфейсах.

Рабочая (выполняемая) конфигурация
----------------------------------

Рабочая конфигурация exim`a находится в одном текстовом файле, разделённом на множество секций. Элементы (записи) этого файла состоят из ключевых слов и значений в стиле конфигуреционного файла Smail 3. Дефолтовый конфигурационный файл, поставляемый с дистрибутивом, подходит для простых вариантов и описан далее в главе :ref:`7 <ch07_00>`.

Интерфейс вызова
----------------

Как и множество других MTA, exim имеет sendmail-совместимый интерфейс командной строки, чтобы он мог быть прямой заменой для */usr/lib/sendmail* или */usr/sbin/sendmail* при отправке почты, но вы не нуждаетесь в каких-либо знаниях о sendmail для запуска exim. Для других действий, кроме отсылки почты, также существуют sendmail-совместимые опции, но те, которые производят вывод (например, **-bp**, которая выводит сообщения находящиеся в очереди) делают это в собственном формате exim`a. Также есть дополнительные опции, совместимые с Smail 3 и некоторые дополнительные опции, являющиеся новыми в exim'e. Глава :ref:`5 <ch05_00>` документирует все опции командной строки exim. Из этой информации автоматически составляется man-страница, являющаяся частью дистрибутива exim.

Управление сообщениями, находящимися в очереди, может осуществляться через привилигированные опции командной строки. Также существует дополнительная программа, называющаяся eximon, предназначенная для работы в X window и предоставляющая графический интерфейс для некоторых административных опций командной строки exim.

Терминология
------------

*Тело* (*body*) сообщения - это фактические данные, которые хочет передать отправитель. Это последняя часть сообщения, она отделена от *заголовка* (*header*, см. ниже) пустой линией.

Когда сообщение не может быть доставлено, то обычно оно возвращается отправителю в виде сообщения об ошибке доставки или *сообщения о недоставке* (*non-delivery report* - NDR). Для этого действия обычно используется термин *рикошет* (*bounce*) и отчёты об ошибках часто называют *рикошетами* (*bounce messages*). Это - короткая запись *ошибочного сообщения о неудаче доставки* (*delivery failure error report*). Такие сообщения обычно имеют пустой адрес отправителя в *конверте* сообщения (*envelope* - смотрите ниже), чтобы исключить рикошеты рикошетов.

Термин *по-умолчанию* (*default*) часто появляется в этом руководстве. Он используется для определения значения, которое будет использовано при отсутствии настроек (этой конкретной опции - прим. lissyara) в конфигурационном файле. Другими словами, оно может задать действие, выполняемое при условии, что в конфигурационном файле не указано иное.

Термин *отсрочка* (*defer*, иногда - задержка) используется, когда доставка сообщения адресату не может быть осуществлена немедленно по каким-либо причинам (хост может быть в дауне или переполнен локальный почтовый ящик пользователя). Такие доставки *отсрочиваются* (*deferred*, или - задерживаются) до более позднего времени.

Слово *домен* (*domain*) иногда используется для обозначения всего, кроме первого компонента имени хоста. В данном документе оно обычно означает часть e-mail адреса, следующую за символом *@*.

Сообщение, находящееся в пути, имеет ассоциированный *конверт* (*envelope*), также как заголовок и тело. Конверт содержит адрес отправителя (тот, кому будут доставляться рикошеты), и любое число адресов получателей. Ссылки на отправителя или получателей сообщения, обычно означают адреса в конверте. MTA использует именно эти, а не фигурирующие в строках заголовков адреса для доставки писем и для возврещения рикошетов.

*Заголовок* (*header*) сообщения - это первая часть текста сообщения, состоящая из множества строк, каждая из которых имеет имя, типа *From:*, *To:*, *Subject:* и т.п. Длинные строки заголовка могут быть разрезаны на несколько строк, с выравниванием продолжений. Заголовок отделён от тела пустой линией.

Термин *локальная часть* (*local part*), взятый из :rfc:`2822`, используется для того, чтобы обозначить часть адреса электронной почты, предшествующую символу *@*. Часть следующая за *@*, называется *домен* (*domain*) или *почтовый домен* (*mail domain*).

Термины *локальная доставка* (*local delivery*) и *удалённая доставка* (*remote delivery*) используются, чтобы отличать доставку в файл или трубу (pipe) на локальном хосте от доставки по SMTP через TCP/IP на другой хост. Все хосты кроме того, на котором запущен exim, считаются *удалёнными* (*remote*).

*Обратный путь* (*Return path*) - другое имя, использующееся для адреса отправителя в конверте сообщения.

Термин *очередь* (*queue*) используется для того, чтобы ссылаться на набор (совокупность) сообщений, ожидающих доставку. Этот термин широко используется в контексте MTA. Однако в случае exim, *очередь* больше походит на объединение, пул сообщений, потому что обычно нет упорядочивания ожидающих сообщений.

Термин *обработчик очереди* (*queue runner*) используется для описания процесса, просматривающего очередь и пытающегося доставить те сообщения, у которых наступило время доставки. Этот термин используется и в других MTA, и также имеет отношение к команде *runq*, но в exim ожидающие сообщения обычно обрабатываются в непредсказуемом порядке.

Термин *директория подкачки* (*spool directory*) используется для обозначения каталога, в котором exim сохраняет сообщения своей очереди, т.е. те, которые находятся в процессе доставки. Не путайте с каталогом, в котором хранятся локальные почтовые ящики, и который некоторые люди также называют *spool directory*. В документации exim слово *spool* всегда используется в первом смысле.
